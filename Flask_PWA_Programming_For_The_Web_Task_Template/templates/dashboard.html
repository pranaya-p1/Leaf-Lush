{% extends 'layout.html' %}
{% block content %}

<section class="dashboard">

    <!-- Welcome Section -->
    <div class="welcome-box outlined-box">
        <h2 class="welcome-header">
            <img src="{{ profile_pic }}" alt="Profile" class="user-avatar">
            Welcome {{ username }}!
        </h2>

        <div class="user-info">
            <p><strong>Bio:</strong> {{ session.get('bio', 'Loves all things green and growing üåø') }}</p>
            <p><strong>Fun Fact:</strong> {{ session.get('fun_fact', 'Once grew a plant from a coffee bean ‚òï') }}</p>
            <a href="{{ url_for('update_profile', username=username) }}" class="btn green-btn">Update Profile</a>
        </div>
    </div>

    <!-- Your Plants -->
    <div class="plants-section outlined-box">
        <h3>View your other plants:</h3>
        <div class="plant-gallery">
            {% if user_plants and user_plants|length > 0 %}
                {% for plant in user_plants %}
                <div class="plant-card">
                    <img src="{{ plant.image }}" alt="{{ plant.name }}">
                    <h4>{{ plant.name }}</h4>
                    <p class="latin">{{ plant.latin_name }}</p>
                    <p class="desc">{{ plant.description }}</p>
                    <p class="age">üå± Age: {{ plant.age }} weeks</p>
                </div>
                {% endfor %}
            {% endif %}
            <a href="{{ url_for('add_plant') }}" class="add-plant-btn">+</a>
        </div>
    </div>

    <!-- Follow Recommendations -->
    <div class="follow-section outlined-box dark-bg">
        <h3>Follow Recommendations:</h3>
        <div class="follow-profiles extended-row">
            {% for user in recommended_users %}
            <div class="profile-card outlined-box">
                <img src="{{ user.image }}" alt="{{ user.name }}">
                <h4>{{ user.name }}</h4>
                <p>{{ user.username }}</p>
                <button class="follow-btn" onclick="toggleFollow(this)">Follow</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Your Posts -->
    <div class="posts-section outlined-box">
        <h3>Your Posts:</h3>
        <div class="posts-grid">
            {% if user_posts and user_posts|length > 0 %}
                {% for post in user_posts %}
                <div class="post-card">
                    <img src="{{ post.image }}" alt="{{ post.title }}" class="post-image">
                    <div class="post-info">
                        <h4 class="post-title">{{ post.title }}</h4>
                        <p class="post-description">{{ post.caption }}</p>
                    </div>
                    <form method="POST" action="{{ url_for('delete_post', post_index=loop.index0) }}" class="delete-form">
                        <button type="submit" class="delete-btn">üóëÔ∏è</button>
                    </form>
                </div>
                {% endfor %}
                <a href="{{ url_for('add_post') }}" class="btn add-post-btn side-btn">+</a>
            {% else %}
                <div class="empty-posts">
                    <p>No posts yet ‚Äî start sharing your garden!</p>
                    <a href="{{ url_for('add_post') }}" class="btn add-post-btn center-btn">+</a>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<script>
function toggleFollow(button) {
  if (button.classList.contains('following')) {
    button.classList.remove('following');
    button.textContent = 'Follow';
  } else {
    button.classList.add('following');
    button.textContent = 'Following';
  }
}
</script>

{% endblock %}
